<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SimpleCapture | HDMI Monitor</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Dancing+Script:wght@600&family=Inter:wght@300;400;600&display=swap');

        :root { 
            --accent: #000;
            --bg-pill: #ffffff;
            --shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        body, html { 
            margin: 0; padding: 0; width: 100%; height: 100%; 
            background: #fff; color: #000; font-family: 'Inter', sans-serif;
            overflow-x: hidden;
        }

        /* Splash Screen */
        #splash { 
            position: fixed; inset: 0; background: #fff; 
            display: flex; flex-direction: column; justify-content: center; 
            align-items: center; z-index: 100; text-align: center;
        }
        #splash h1 { font-size: 2.5rem; margin: 0; letter-spacing: -1px; }
#splash p {
    font-size: 1.1rem;
    color: #444;
    max-width: 500px;
    margin: 10px 20px;
    line-height: 1.4;
    font-weight: 400;
}

#splash .branding {
    font-family: 'Dancing Script', cursive;
    color: #666;
    font-size: 1.4rem;
    margin-top: 0; /* Changed from 5px */
    margin-bottom: 35px; /* Slightly reduced */
}
        .btn-start { 
            background: #000; color: #fff; border: none; padding: 16px 40px; 
            border-radius: 50px; font-weight: 600; cursor: pointer; font-size: 1rem;
        }

        /* Main Viewport */
        #app-viewport { height: 100vh; width: 100vw; display: flex; align-items: center; justify-content: center; position: relative; background: #000; cursor: none; }
        video { width: 100%; height: 100%; object-fit: contain; }

        /* Recording Indicator */
        #recIndicator {
            position: fixed; top: 20px; right: 20px; width: 15px; height: 15px;
            background: red; border-radius: 50%; display: none;
            box-shadow: 0 4px 10px rgba(0,0,0,0.8); z-index: 60;
            animation: blink 1s infinite;
        }
        @keyframes blink { 0% { opacity: 1; } 50% { opacity: 0.3; } 100% { opacity: 1; } }

        /* Floating Pill UI */
        #controls-container {
            position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
            display: flex; gap: 8px; padding: 8px 16px;
            background: var(--bg-pill); border-radius: 100px;
            box-shadow: var(--shadow); z-index: 50; transition: 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            align-items: center;
        }
        /* Fully hide when idle */
        .idle { opacity: 0; pointer-events: none; transform: translateX(-50%) translateY(30px); }

        /* Control display mode when moving mouse */
        body.active-mouse #app-viewport { cursor: default; }

        select, .icon-btn { 
            background: none; border: none; color: #000; font-weight: 600; 
            cursor: pointer; padding: 8px; border-radius: 20px; font-size: 13px; 
            outline: none;
        }
        select { border-right: 1px solid #eee; margin-right: 5px; }

        /* Kebab Menu Styles */
        .menu-container { position: relative; display: inline-block; }
        #kebabMenu {
            position: absolute; bottom: 50px; right: 0; background: #fff;
            box-shadow: var(--shadow); border-radius: 15px; width: 200px;
            display: none; flex-direction: column; padding: 8px; overflow: hidden;
        }
        #kebabMenu button, #kebabMenu a {
            background: none; border: none; color: #000; padding: 12px;
            text-align: left; font-size: 13px; font-weight: 500; cursor: pointer;
            text-decoration: none; border-radius: 10px;
        }
        #kebabMenu button:hover, #kebabMenu a:hover { background: #f5f5f5; }
        .hint { float: right; color: #999; font-size: 10px; }

        /* About Section */
        #content-section { padding: 80px 20px; max-width: 800px; margin: 0 auto; line-height: 1.8; color: #333; }
        h2 { border-bottom: 2px solid #eee; padding-bottom: 10px; }
    </style>
</head>
<body>

    <div id="recIndicator"></div>

    <div id="splash">
    <h1>Simple Capture</h1>
    <p>Use Laptop/Mobile/iPad as a monitor for your Game consoles without any external software</p>
    <div class="branding">made by vmg</div>
    <button id="initBtn" class="btn-start">Open Monitor</button>
</div>

    <div id="app-viewport">
        <video id="monitor" autoplay playsinline></video>
        
        <div id="controls-container">
            <select id="videoSource"></select>
            <select id="audioSource"></select>
            
            <div class="menu-container">
                <button class="icon-btn" id="menuToggle">â‹®</button>
                <div id="kebabMenu">
                    <button id="shotBtn"> Screenshot <span class="hint">[C]</span></button>
                    <button id="recBtn"> Record <span class="hint">[R]</span></button>
                    <button id="fsBtn"> Fullscreen <span class="hint">[F]</span></button>
                    <hr style="border:0; border-top:1px solid #eee; margin:5px 0;">
                    <a href="https://paypal.me/VarahamihirGupta366" target="_blank"> Buy me a tea</a>
                    <a href="mailto:varahamihirgupta@gmail.com"> Write to me</a>
                </div>
            </div>
        </div>
    </div>

    <div id="content-section">
        <h2>About</h2>
        <p>With this tool you can connect your Xbox or Playstation to your laptop/ipad/android mobile and use that screen as a monitor for a stable framerate HDMI input. All you need is a capture card hooked up into your device's USB port and the webpage will recognize it as a webcam feed</p>
        <h2>Shortcuts</h2>
        <ul>
            <li><strong>[F]</strong>: Toggle Fullscreen</li>
            <li><strong>[C]</strong>: Capture PNG Photo</li>
            <li><strong>[R]</strong>: Toggle Video Recording</li>
        </ul>
    </div>

    <canvas id="canvas" style="display:none"></canvas>

    <script>
        const videoEl = document.getElementById('monitor');
        const videoSelect = document.getElementById('videoSource');
        const audioSelect = document.getElementById('audioSource');
        const menu = document.getElementById('kebabMenu');
        const recIndicator = document.getElementById('recIndicator');
        let mediaRecorder;
        let recordedChunks = [];

        // Menu Logic
        document.getElementById('menuToggle').onclick = (e) => {
            menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
            e.stopPropagation();
        };
        window.onclick = () => menu.style.display = 'none';

        // Stream & Permissions
        async function init() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ audio: true, video: true });
                stream.getTracks().forEach(t => t.stop());
                const devices = await navigator.mediaDevices.enumerateDevices();
                
                videoSelect.innerHTML = '';
                audioSelect.innerHTML = '';

                devices.forEach(d => {
                    const opt = new Option(d.label || (d.kind === 'videoinput' ? 'Camera' : 'Audio'), d.deviceId);
                    if (d.kind === 'videoinput') videoSelect.add(opt);
                    else if (d.kind === 'audioinput') audioSelect.add(opt);
                });
                document.getElementById('splash').style.display = 'none';
                startStream();
            } catch (err) { alert("Please grant camera/mic permissions."); }
        }

        async function startStream() {
            if (window.currentStream) window.currentStream.getTracks().forEach(t => t.stop());
            try {
                const stream = await navigator.mediaDevices.getUserMedia({
                    video: { deviceId: videoSelect.value ? { exact: videoSelect.value } : undefined, frameRate: { ideal: 60 }, width: { ideal: 1920 } },
                    audio: { deviceId: audioSelect.value ? { exact: audioSelect.value } : undefined, echoCancellation: false }
                });
                window.currentStream = stream;
                videoEl.srcObject = stream;
                videoEl.muted = false;
            } catch (e) { console.error("Stream failed", e); }
        }

        // Utility Functions
        function toggleFullscreen() {
            if (!document.fullscreenElement) document.documentElement.requestFullscreen();
            else document.exitFullscreen();
        }

        function takeScreenshot() {
            const canvas = document.getElementById('canvas');
            canvas.width = videoEl.videoWidth;
            canvas.height = videoEl.videoHeight;
            canvas.getContext('2d').drawImage(videoEl, 0, 0);
            const link = document.createElement('a');
            link.download = `capture-${Date.now()}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }

        function toggleRecord() {
            if (mediaRecorder && mediaRecorder.state === "recording") {
                mediaRecorder.stop();
                recIndicator.style.display = 'none';
            } else {
                recordedChunks = [];
                mediaRecorder = new MediaRecorder(window.currentStream, { mimeType: 'video/webm' });
                mediaRecorder.ondataavailable = e => recordedChunks.push(e.data);
                mediaRecorder.onstop = () => {
                    const a = document.createElement('a');
                    a.href = URL.createObjectURL(new Blob(recordedChunks, { type: 'video/webm' }));
                    a.download = `recording-${Date.now()}.webm`;
                    a.click();
                };
                mediaRecorder.start();
                recIndicator.style.display = 'block';
            }
        }

        // Events
        document.getElementById('initBtn').onclick = init;
        document.getElementById('shotBtn').onclick = takeScreenshot;
        document.getElementById('recBtn').onclick = toggleRecord;
        document.getElementById('fsBtn').onclick = toggleFullscreen;
        videoSelect.onchange = startStream;
        audioSelect.onchange = startStream;

        window.onkeydown = e => { 
            const key = e.key.toLowerCase();
            if(key === 'c') takeScreenshot();
            if(key === 'f') toggleFullscreen();
            if(key === 'r') toggleRecord();
        };

        let timer;
        document.onmousemove = () => {
            document.body.classList.add('active-mouse');
            document.getElementById('controls-container').classList.remove('idle');
            clearTimeout(timer);
            timer = setTimeout(() => {
                document.getElementById('controls-container').classList.add('idle');
                document.body.classList.remove('active-mouse');
                menu.style.display = 'none';
            }, 3000);
        };
    </script>
</body>
</html>